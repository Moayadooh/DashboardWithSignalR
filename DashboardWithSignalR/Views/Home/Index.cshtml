@{
    ViewData["Title"] = "Home Page";
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@@microsoft/signalr/dist/browser/signalr.min.js"></script>

<style>
    html, body {
        height: 100%;
        margin: 0;
    }

    .dashboard {
        height: 100vh;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 12px;
        padding: 12px;
        box-sizing: border-box;
    }

    .chart {
        position: relative;
        width: 100%;
        height: 100%;
    }

    canvas {
        width: 100% !important;
        height: 100% !important;
    }

    /* Optional card look */
    .card {
        background: #ffffff;
        border-radius: 10px;
        padding: 10px;
    }
</style>

<div class="text-center">
    <div class="dashboard">
        <div class="chart card">
            <canvas id="lineChart"></canvas>
        </div>

        <div class="chart card">
            <canvas id="barChart"></canvas>
        </div>

        <div class="chart card" style="height: 80%">
            <canvas id="doughnutChart"></canvas>
        </div>
    </div>
</div>

<script>
    const lineChart = new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'CPU Usage',
                data: [],
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    const barChart = new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: ['Success', 'Failed'],
            datasets: [{
                label: 'Requests',
                data: [0, 0]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    const doughnutChart = new Chart(document.getElementById('doughnutChart'), {
        type: 'doughnut',
        data: {
            labels: ['Chrome', 'Edge', 'Firefox'],
            datasets: [{
                data: [0, 0, 0]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

</script>

<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chartHub")
        .build();

    // Line chart update
    connection.on("UpdateLineChart", value => {
        lineChart.data.labels.push(new Date().toLocaleTimeString());
        lineChart.data.datasets[0].data.push(value);

        if (lineChart.data.labels.length > 15) {
            lineChart.data.labels.shift();
            lineChart.data.datasets[0].data.shift();
        }

        lineChart.update();
    });

    // Bar chart update
    connection.on("UpdateBarChart", data => {
        barChart.data.datasets[0].data = data;
        barChart.update();
    });

    // Doughnut chart update
    connection.on("UpdateDoughnutChart", data => {
        doughnutChart.data.datasets[0].data = data;
        doughnutChart.update();
    });

    connection.start();
</script>
